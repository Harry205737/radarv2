<!DOCTYPE html>
<html>
<head>
    <title>Radar Lite</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background: #222; color: #fff; font-family: sans-serif; text-align: center; margin: 0; }
        #wrapper { position: relative; width: 512px; height: 512px; margin: 10px auto; border: 1px solid #444; }
        img, canvas { position: absolute; top: 0; left: 0; width: 512px; height: 512px; }
        .ui { padding: 15px; }
    </style>
</head>
<body>

<div class="ui">
    <strong>Laverton 128km</strong><br>
    <small id="status">Loading...</small><br>
    <button onclick="fetchRadar()">Refresh Now</button>
</div>

<div id="wrapper">
    <img src="128melradar.jpg">
    <canvas id="radar" width="512" height="512"></canvas>
</div>

<script>
    const canvas = document.getElementById('radar');
    const ctx = canvas.getContext('2d');
    const status = document.getElementById('status');

    function fetchRadar() {
        status.innerText = "Fetching...";
        const img = new Image();
        
        // Use the CDN link. IDR023 is Laverton 128km.
        // We add a cache-buster at the end.
        const cacheBuster = Math.floor(Date.now() / 60000); 
        img.crossOrigin = "anonymous"; 
        img.src = "https://api.allorigins.win/raw?url=" + encodeURIComponent("http://www.bom.gov.au/radar/IDR023.T.png?v=" + cacheBuster);

        img.onload = function() {
            ctx.clearRect(0, 0, 512, 512);
            ctx.drawImage(img, 0, 0, 512, 512);
            status.innerText = "Last update: " + new Date().toLocaleTimeString();
        };

        img.onerror = function() {
            status.innerText = "Failed to load radar. BoM might be blocking the request.";
            console.error("Radar load failed.");
        };
    }

    fetchRadar();
    setInterval(fetchRadar, 300000); // 5 min auto-refresh
</script>

</body>
</html>
