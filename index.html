<!DOCTYPE html><html><title>REMOTE RADAR</title>
<body style="text-align:center;font:12px sans-serif;background:#fff;margin:0;overflow:hidden">
 <h3>128km Melbourne Radar</h3>
 
 <div style="position:relative;width:256px;height:256px;margin:auto;overflow:hidden;background:#eee">
  <div style="background:url('mp.webp')0/256px;width:256px;height:256px;position:absolute"></div>
  
  <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:9;text-shadow:1px 1px 1px #fff">+</div>
  
  <img id=R onload="this.style.filter='none'" style="position:absolute;opacity:.7;width:512px;image-rendering:pixelated;transition:filter .2s">
 </div>

 <div style="margin-top:10px">
  <button onclick=c(-1) style="width:40px"><</button>
  <button onclick="p()" id=PB style="width:60px">PLAY</button>
  <button onclick="f()" id=RB style="width:80px">LOAD</button>
  <button onclick=c(1) style="width:40px">></button>
 </div>
 <p id=M style="color:#666;margin-top:5px">Ready</p>

<script>
H=[];I=-1;y=-37.855;x=144.755;L=0;

f=()=>{ 
 RB.innerText='...';
 fetch('https://api.rainviewer.com/public/weather-maps.json').then(r=>r.json()).then(j=>{
  H=[];
  j.radar.past.slice(-6).forEach(o=>{ 
   t=o.time;v=64;pX=x/360+.5;pY=(1-Math.log(Math.tan(y*Math.PI/180)+1/Math.cos(y*Math.PI/180))/Math.PI)/2;
   H.push({
    u:`${j.host}/v2/radar/${t}/256/6/${0|pX*v}/${0|pY*v}/2/1_1.webp`,
    t:new Date(t*1000).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}),
    x:128-(pX*v%1*512),
    y:128-(pY*v%1*512)
   });
  });
  I=H.length-1;d();RB.innerText='REFRESH';
 }).catch(e=>M.innerText='No Signal');
};

d=()=>{
 if(H[I]){
  R.style.filter='blur(2px)'; // Visual cue that a new frame is loading
  R.src=H[I].u;
  R.style.left=H[I].x+'px';
  R.style.top=H[I].y+'px';
  M.innerText=H[I].t;
 }
};

c=n=>{if(H[I+n]){I+=n;d()}else if(n>0){I=0;d()}};

p=()=>{
 if(L){clearInterval(L);L=0;PB.innerText='PLAY'}
 else{if(H.length<1){f()}L=setInterval(()=>c(1),800);PB.innerText='STOP'}
};
</script></html>
