<!DOCTYPE html>
<html>
<head>
    <title>Radar Lite</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; margin: 0; padding: 10px; }
        #map-box { position: relative; width: 512px; height: 512px; margin: 0 auto; background: #222; overflow: hidden; }
        /* Layer 1: Your local map */
        #bg { position: absolute; top: 0; left: 0; width: 512px; height: 512px; z-index: 1; }
        /* Layer 2: RainViewer Tile */
        #radar { position: absolute; top: 0; left: 0; width: 512px; height: 512px; z-index: 2; opacity: 0.7; }
        .ctrl { margin: 10px 0; }
        button { padding: 8px 15px; background: #333; color: #fff; border: 1px solid #555; cursor: pointer; }
    </style>
</head>
<body>

    <div class="ctrl">
        <strong>Laverton 128km</strong><br>
        <span id="ts" style="font-size: 12px; color: #888;">...</span><br>
        <button onclick="fetchRadar()">REFRESH</button>
    </div>

    <div id="map-box">
        <img id="bg" src="128melradar.jpg">
        <img id="radar">
    </div>

    <script>
        const M = document.getElementById('ts');
        const R = document.getElementById('radar');

        const fetchRadar = () => {
            M.innerText = 'Syncing...';
            
            fetch('https://api.rainviewer.com/public/weather-maps.json')
                .then(r => r.json())
                .then(j => {
                    const t = j.radar.past.at(-1).time;
                    
                    // FIXED COORDINATES FOR LAVERTON AT ZOOM 6
                    // This aligns with a 128km radius map
                    const z = 6;
                    const x = 56;
                    const y = 39;

                    // Color 1 is standard RainViewer / 1_1 is smooth snow-off
                    const url = `${j.host}/v2/radar/${t}/512/${z}/${x}/${y}/1/1_1.png`;
                    
                    R.src = url;
                    M.innerText = new Date(t * 1000).toLocaleTimeString();
                })
                .catch(e => {
                    M.innerText = 'Error loading tile';
                    console.error(e);
                });
        };

        // Initial Load
        fetchRadar();
        // Auto-refresh every 6 minutes
        setInterval(fetchRadar, 360000);
    </script>
</body>
</html>
